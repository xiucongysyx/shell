var GetQnAWithTopicForCarousel;(function(n){var t=function(){function n(n,t,i,r){var u=this,f;for(this.topicqnaSelector="df_topicqna .slide",this.topicElementSelector="a_dummy.rel_tpc",this.moreQnAContainerName="df_moreqna_0",this.topicContainerClassPattern="df_topicqna",this.topicImageAttributionClassPattern="df_topicattr",this.primaryQnAContainerId="relatedQnAListDisplay",this.moreQnALoaderName="df_load",this.errorContainerName=".df_paaError, .df_paaError *",this.hideElementClassName="b_hide",this.selectedTopicClassName="tpc_selected",this.fetchSpinnerIconUrl="/rqna/fetchSpinnerIcon",this.fetchErrorIconUrl="/rqna/fetchErrorIcon",this.slctrClassPrefix=".",this.AjaxParams={url:null,callback:null},this.CallCompleteForTopic=!1,this.GetQnAForTopicUrl=n,this.MoreQnAContainer=_ge(this.moreQnAContainerName),this.MoreQnALoader=_ge(this.moreQnALoaderName),this.ErrorContainerList=_d.querySelectorAll(this.errorContainerName),this.PrimaryQnAContainer=_ge(this.primaryQnAContainerId),this.TopicList=_d.querySelectorAll(this.slctrClassPrefix+this.topicElementSelector),this.TopicContainerList=_d.querySelectorAll(this.slctrClassPrefix+this.topicContainerClassPattern),this.TopicImageAttributionList=_d.querySelectorAll(this.slctrClassPrefix+this.topicImageAttributionClassPattern),this.PreviousSelectedTopicIndex="0",this.QnAFetchCount=0,this.TopicLanguageCode=t,this.UserQuery=i,this.CarouselExperience=r,f=0;f<this.TopicList.length;f++)sj_be(this.TopicList[f],"click",function(n){return u.getQnAForTopic(n.currentTarget)}),sj_be(this.TopicList[f],"keyup",function(n){return u.handleKeyboardEventForTopic(n)});sj_be(_w,"scroll",function(){return u.delayedFetch()});sj_be(_w,"resize",function(){return u.delayedFetch()});sj_evt.bind("onP1",function(){return u.fetchSpinnerIcon()},!0);sj_evt.bind("onP1",function(){return u.fetchErrorIcon()},!0)}return n.prototype.handleKeyboardEventForTopic=function(n){(n.keyCode===13||n.keyCode===32)&&this.getQnAForTopic(n.currentTarget)},n.prototype.getQnAForTopic=function(n){var o=this,r=n,u,t;if(n!=this.PreviousTargetTopic||this.CallCompleteForTopic){this.PreviousTargetTopic=n;var f=r.getAttribute("data-query"),e=r.getAttribute("data-IID"),i=r.getAttribute("data-topicIndex");if(this.PreviousSelectedTopicIndex!=i){for(Log.Log("CI.TopicQnA","TopicClick","UserClick",!1,"TopicName",f,"TopicIndex",i,"KId",e),this.PreviousSelectedTopicIndex=i,t=0;t<this.ErrorContainerList.length;t++)sa_cl(this.ErrorContainerList[t],this.hideElementClassName,!0);for(t=0;t<this.TopicList.length;t++)t.toString()==i?sa_cl(this.TopicList[t],this.selectedTopicClassName,!0):sa_cl(this.TopicList[t],this.selectedTopicClassName,!1);for(u=0,t=0;t<this.TopicContainerList.length;t++)t.toString()==i?(sa_cl(this.TopicContainerList[t],this.hideElementClassName,!1),u+=this.TopicContainerList[t].querySelectorAll(this.slctrClassPrefix+this.topicqnaSelector).length,t==0&&(sa_cl(this.PrimaryQnAContainer,this.hideElementClassName,!1),this.PrimaryQnAContainer&&this.PrimaryQnAContainer.childElementCount&&(u+=this.PrimaryQnAContainer.childElementCount))):(sa_cl(this.TopicContainerList[t],this.hideElementClassName,!0),t==0&&sa_cl(this.PrimaryQnAContainer,this.hideElementClassName,!0));for(t=0;t<this.TopicImageAttributionList.length;t++)t.toString()==i?sa_cl(this.TopicImageAttributionList[t],this.hideElementClassName,!1):sa_cl(this.TopicImageAttributionList[t],this.hideElementClassName,!0);if(u==0){sa_cl(this.MoreQnALoader,this.hideElementClassName,!1);var s=encodeURIComponent(f),h=encodeURIComponent(this.UserQuery),c=this.GetQnAForTopicUrl+s+"&IID="+e+"&lang="+this.TopicLanguageCode+"&userQuery="+h+"&SnrPAAUXType="+this.CarouselExperience,l=function(n,t){return o.requestCallBackForTopic(n,t,r,i)};this.CallCompleteForTopic=!1;sj_ajax(c,{callback:l})}}}},n.prototype.fetchSpinnerIcon=function(){var n=this,t=function(t,i){return n.fetchSpinnerCallBack(t,i)};sj_ajax(this.fetchSpinnerIconUrl,{callback:t})},n.prototype.fetchSpinnerCallBack=function(n,t){n&&t.appendTo(this.MoreQnALoader)},n.prototype.fetchErrorIcon=function(){var n=this,t=function(t,i){return n.fetchErrorCallBack(t,i)};sj_ajax(this.fetchErrorIconUrl,{callback:t})},n.prototype.fetchErrorCallBack=function(n,t){if(n)for(var i=0;i<this.ErrorContainerList.length;i++)t.appendTo(this.ErrorContainerList[i])},n.prototype.requestCallBackForTopic=function(n,t,i,r){var f=this,u;if(n)t.appendTo(this.TopicContainerList[r]),setTimeout(function(){for(var t=f.TopicContainerList[r].querySelectorAll(f.slctrClassPrefix+f.topicqnaSelector),n=0;n<t.length;n++)sa_cl(t[n],"transform",!0)},100),typeof rms!="undefined"&&rms.start();else{for(u=0;u<this.ErrorContainerList.length;u++)u.toString()==r&&this.PreviousSelectedTopicIndex==r?sa_cl(this.ErrorContainerList[u],this.hideElementClassName,!1):sa_cl(this.ErrorContainerList[u],this.hideElementClassName,!0);Log.Log("CI.TopicQnA","TopicQnAFetch","FetchFailed",!1,"Url",this.GetQnAForTopicUrl);this.hideLoaderForTopics()}this.CallCompleteForTopic=!0;this.hideLoaderForTopics()},n.prototype.isQnABottomScrolledIntoView=function(){var n=this.MoreQnAContainer.getBoundingClientRect();return n.bottom<=_w.innerHeight},n.prototype.hideLoaderForTopics=function(){sa_cl(this.MoreQnALoader,this.hideElementClassName,!0)},n.prototype.delayedFetch=function(){this.AjaxParams.url!=null&&this.AjaxParams.callback!=null&&this.isQnABottomScrolledIntoView()&&(sj_ajax(this.AjaxParams.url,{callback:this.AjaxParams.callback}),this.AjaxParams={url:null,callback:null},this.QnAFetchCount++)},n}();n.QnAFetcher=t;sj_evt.fire("OnGetQnAWithTopicForCarouselInitComplete")})(GetQnAWithTopicForCarousel||(GetQnAWithTopicForCarousel={}))